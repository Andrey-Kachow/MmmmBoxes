<link
  rel="stylesheet"
  href="{{ url_for('static', filename='package-table.css') }}"
/>

<table id="packages-table">
  <tr class="packages-row">
    <th class="packages-col-heading">Package Owner</th>
    <th class="packages-col-heading">Package Title</th>
    <th class="packages-col-heading-date">Delivered</th>
    <th class="packages-col-heading-date">Collected</th>
    {% if show-signature-button %}
    <th class="packages-col-heading">Signature</th>
    {% endif %}
  </tr>

  {% set ns = namespace(last-delivered="")%} {% for package in
  get-package-list()|sort(reverse=True, attribute="delivered") %} {% if
  ns.last-delivered != package.delivered[:10] and ns.last-delivered != "" %}
  <tr>
    <td class="packages-spacer" style="border-width: 0"></td>
  </tr>
  {% endif %}
  <tr class="packages-row">
    <td class="packages-col">
      <div class="card-block">
        <p class="text-center">
          <span class="mytooltip tooltip-effect-1">
            <span class="tooltip-item">{{ package.fullname }}</span>
            <span class="tooltip-content clearfix">
              <img
                src="https://thiscatdoesnotexist.com/"
                width="128"
                height="128"
              />
              <span class="tooltip-text"
                >{{ package.fullname }} <br />
                {{package.email}}
              </span>
              <a href="/officer/residents/{{ package.resident-id }}/profile"
                >View resident profile</a
              >
            </span>
          </span>
        </p>
      </div>
    </td>
    <td class="packages-col">{{ package.title }}</td>
    <td class="packages-col">{{ package.deliverednice }}</td>
    {% if package.collectednice == "Collection pending" %}
    <td class="packages-col">
      Collection Pending
      <button
        onclick="document.getElementById('collect-{{ package.id}}').style.display='block'"
      >
        Collect Package
      </button>

      <div id="collect-{{ package.id }}" class="modal">
        <span
          onclick="document.getElementById('collect-{{package.id}}').style.display='none'"
          class="close"
          title="Close Modal"
          >×</span
        >
        <form class="modal-content" action="/action-page.php">
          <div class="container">
            <h1>Collect Package</h1>
            <p>
              Confirm package entitled {{ package.title }} has been collected by
              {{package.fullname}}
            </p>

            <div class="clearfix">
              <button
                type="button"
                onclick="document.getElementById('collect-{{ package.id }}').style.display='none'"
                class="cancelbtn"
              >
                Cancel
              </button>
              <a
                href="{{ url_for('officer.collect-package', package-id=package.id) }}"
                ><button type="button" class="deletebtn">Confirm</button></a
              >
            </div>
          </div>
        </form>
      </div>
      <button
        class="delete"
        onclick="document.getElementById('delete-{{ package.id }}').style.display='block'"
      >
        Delete Package
      </button>

      <div id="delete-{{ package.id }}" class="modal">
        <span
          onclick="document.getElementById('delete-{{package.id}}').style.display='none'"
          class="close"
          title="Close Modal"
          >×</span
        >
        <form class="modal-content" action="/action-page.php">
          <div class="container">
            <h1>Delete Package</h1>
            <p>
              Confirm you wish to delete package entitled {{ package.title }}
              meant to be collected by {{package.fullname}}. Perhaps remind them
              instead.
            </p>

            <div class="clearfix">
              <button
                type="button"
                onclick="document.getElementById('delete-{{ package.id }}').style.display='none'"
                class="cancelbtn"
              >
                Cancel
              </button>
              <a
                href="{{ url_for('officer.delete-package', package-id=package.id) }}"
                ><button type="button" class="deletebtn">Delete</button></a
              >
            </div>
          </div>
        </form>
      </div>
    </td>

    {% else %}
    <td class="packages-col">{{ package.collectednice }}</td>
    {% endif %} {% include 'common/signature-btns-col.html' %}
  </tr>

  {% set ns.last-delivered = package.delivered[:10] %} {% endfor %}
</table>

{% include 'common/signature-canvas.html' %} {% include 'common/js-libs.html' %}
<script type="text/javascript" charset="utf-8">
  let socket = io();
  socket.on("new-package", (data) => {
    console.log(data);
    let package-table = document.getElementById("packages-table");
    let package-row = package-table.insertRow(1);
    package-row.classList.add("packages-row");

    let fullname-cell = package-row.insertCell();
    fullname-cell.classList.add("packages-col");
    fullname-cell.appendChild(document.createTextNode(data.fullname));

    let email-cell = package-row.insertCell();
    email-cell.classList.add("packages-col");
    email-cell.appendChild(document.createTextNode(data.email));

    let title-cell = package-row.insertCell();
    title-cell.classList.add("packages-col");
    title-cell.appendChild(document.createTextNode(data.title));

    let delivered-cell = package-row.insertCell();
    delivered-cell.classList.add("packages-col");
    delivered-cell.appendChild(document.createTextNode(data.deliverednice));

    let collected-cell = package-row.insertCell();
    collected-cell.classList.add("packages-col");
    collected-cell.appendChild(document.createTextNode(data.collectednice));
  });
</script>
